<!DOCTYPE html>
<html lang="en">

<head>
  <title>Developer's community - Develonity</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Mukta:300,400,700">
  <link rel="stylesheet" href="fonts/icomoon/style.css">

  <link rel="stylesheet" href="css/bootstrap.min.css">
  <link rel="stylesheet" href="css/magnific-popup.css">
  <link rel="stylesheet" href="css/jquery-ui.css">
  <link rel="stylesheet" href="css/owl.carousel.min.css">
  <link rel="stylesheet" href="css/owl.theme.default.min.css">


  <link rel="stylesheet" href="css/aos.css">

  <link rel="stylesheet" href="css/style.css">

</head>

<body>

  <div class="site-wrap">
    <header class="site-navbar" role="banner">
      <div class="site-navbar-top">
        <div class="container">
          <div class="row align-items-center">

            <div class="col-6 col-md-4 order-2 order-md-1 site-search-icon text-left">
              <form action="" class="site-block-top-search">
                <!-- <span class="icon icon-search2"></span>
                <input type="text" class="form-control border-0" placeholder="Search"> -->
              </form>
            </div>

            <div class="col-12 mb-3 mb-md-0 col-md-4 order-1 order-md-2 text-center">
              <div class="site-logo">
                <a href="index.html" class="js-logo-clone">Develonity</a>
              </div>
            </div>

            <div class="col-6 col-md-4 order-3 order-md-3 text-right">
              <div class="site-top-icons">
                <ul>
                  <li><a href="#"><span class="icon icon-person"></span></a></li>
                  <li><a href="#"><span class="icon icon-heart-o"></span></a></li>
                  <li>
                    <a href="orderList.html" class="site-cart">
                      <span class="icon icon-shopping_cart"></span>
                    </a>
                  </li>
                  <li class="d-inline-block d-md-none ml-md-0"><a href="#" class="site-menu-toggle js-menu-toggle"><span
                        class="icon-menu"></span></a></li>
                </ul>
              </div>
            </div>

          </div>
        </div>
      </div>
      <nav class="site-navigation text-right text-md-center" role="navigation">
        <div class="container">
          <ul class="site-menu js-clone-nav d-none d-md-block">
            <li><a href="index.html">Home</a></li>
            <li><a href="#">Community</a></li>
            <li><a href="#">Q&A</a></li>
            <li><a href="shop.html">GiftCard Shop</a></li>
            <li><a href="contact.html">Contact</a></li>
          </ul>
        </div>
      </nav>
    </header>

    <div class="bg-light py-3">
      <div class="container">
        <div class="row">
          <div class="col-md-12 mb-0"><a href="index.html">Home</a> <span class="mx-2 mb-0">/</span> <strong
              class="text-black">GiftCard Shop</strong></div>
        </div>
      </div>
    </div>

    <div class="site-section" id="please">
      <div class="container">

        <div class="row mb-5">
          <div class="col-md-9 order-2">

            <div class="row" id="categoryAndSort">
              <div class="col-md-12 mb-5">
                <div class="float-md-left mb-4">
                  <h2 class="text-black h5" id="categoryName"></h2>
                </div>
                <div id="sortBox">
                  <div class="pagination" style="float: right;">
                    정렬:
                    <select id="sorting" onchange="giftCardListing()">
                      <option value="name">상품명</option>
                      <option value="price">가격</option>
                    </select>
                    <input type="radio" name="isAsc" value="true" onchange="giftCardListing()" checked /> 오름차순
                    <input type="radio" name="isAsc" value="false" onchange="giftCardListing()" /> 내림차순
                  </div>
                  <div id="pagination" class="pagination"></div>
                </div>
              </div>
            </div>

            <div class="row mb-5" id="gift-cards-box">
            </div>

            <div class="row" data-aos="fade-up">
              <div class="col-md-12 text-center">
                <div class="site-block-27">
                  <ul id="pages">
                    <!-- <li><a href="#">&lt;</a></li>
                    <li class="active"><span>1</span></li>
                    <li><a href="#">2</a></li>
                    <li><a href="#">3</a></li>
                    <li><a href="#">4</a></li>
                    <li><a href="#">5</a></li>
                    <li><a href="#">&gt;</a></li> -->
                  </ul>
                </div>
              </div>
            </div>
          </div>

          <div class="col-md-3 order-1 mb-5 mb-md-0">
            <div class="border p-4 rounded mb-4">
              <h3 class="mb-3 h6 text-uppercase text-black d-block">Categories</h3>
              <ul class="list-unstyled mb-0">
                <li class="mb-1" onclick="getGiftCardList(this)" class="d-flex"
                  style="cursor: pointer; color: #7971ea;">
                  <span id="AllCategory">All</span> <span class="text-black ml-auto"></span>
                </li>
                <li class="mb-1" onclick="getGiftCardList(this)" class="d-flex"
                  style="cursor: pointer; color: #7971ea;"><span id="CafeCategory">Cafe</span> <span
                    class="text-black ml-auto"></span>
                </li>
                <li class="mb-1" onclick="getGiftCardList(this)" class="d-flex"
                  style="cursor: pointer; color: #7971ea;"><span id="ChickenCategory">Chicken</span> <span
                    class="text-black ml-auto"></span>
                </li>
                <li class="mb-1" onclick="getGiftCardList(this)" class="d-flex"
                  style="cursor: pointer; color: #7971ea;"><span id="ConvenienceCategory">Convenience Store</span> <span
                    class="text-black ml-auto"></span></li>

              </ul>
            </div>
          </div>
        </div>
      </div>
    </div>


  </div>

  <script src="js/jquery-3.3.1.min.js"></script>
  <script src="js/jquery-ui.js"></script>
  <script src="js/popper.min.js"></script>
  <script src="js/bootstrap.min.js"></script>
  <script src="js/owl.carousel.min.js"></script>
  <script src="js/jquery.magnific-popup.min.js"></script>
  <script src="js/aos.js"></script>

  <script src="js/main.js"></script>

  <script>
    $(document).ready(function () {
      giftCardListing()
    });

    let TOTAL_ELEMENTS = 0; // 데이터 총 개수
    const SIZE = 12; // 화면에 출력 개수
    let TOTAL_PAGES = 0; // 총 페이지

    const VIEW_SECTION = 5; // 페이지 버튼 출력 개수
    let TOTAL_SECTION = Math.ceil(TOTAL_PAGES / VIEW_SECTION) // 총 페이지 수

    var page = 1; // 페이지가 1부터 시작할 때
    let currentPage;

    // // TODO: add onclick of page-button
    // function todo(element) {
    //   return () => {
    //     const id = localStorage.getItem("currentPage") // 없으면 undefined
    //     if (!id) {
    //       localStorage.setItem("currentPage", element.id)
    //       element.className = "active"
    //     } else {
    //       const el = document.getElementById(id);
    //       el.className = ""
    //       localStorage.setItem("currentPage", element.id)
    //       element.className = "active"
    //     }
    //   }
    // }

    // 상품가져오는 API 호출하는 함수
    function getItems(category, currentPage, sorting, isAsc) {
      var settings = {
        "url": `http://localhost:8080/api/gift-cards/category?category=${category}&currentPage=${currentPage}&size=12&sortBy=${sorting}&ascOrDesc=${isAsc}`,
        "method": "GET",
        "timeout": 3000,
      };

      $.ajax(settings).done(function (response) {
        $('#gift-cards-box').empty()
        console.log(response);
        let rows = response['content'];

        // let pagesUl = document.getElementById("pages")

        // // 왼쪽 화살표
        // const leftLi = document.createElement('li')
        // const leftA = document.createElement('a')
        // leftA.text = "<"
        // leftA.href = "#"
        // leftLi.appendChild(leftA)
        // pagesUl.appendChild(leftLi)
        // // ------------------------

        // let pages = +response['totalPages'] // String을 Num으로 받음
        // for (let i = 1; i <= pages; i++) {
        //   let el = document.createElement("li")
        //   let aEl = document.createElement("span")
        //   aEl.textContent = i // 화면에 보이는 데이터
        //   el.id = i // li 태그의 id

        //   el.onclick = todo(el); // 함수 원형만 초기화 가능

        //   el.appendChild(aEl)
        //   pagesUl.appendChild(el)
        // }

        // const rightLi = document.createElement('li')
        // const rightA = document.createElement('a')
        // rightA.text = ">"
        // rightA.href = "#"
        // rightLi.appendChild(rightA)
        // pagesUl.appendChild(rightLi)

        // let currentUl = document.getElementById("pages");
        // currentUl.create

        for (let i = 0; i < rows.length; i++) {
          let name = rows[i]['name']
          let details = rows[i]['details']
          let imageUrl = rows[i]['imagePath']
          let price = rows[i]['price']
          let id = rows[i]['id']

          let temp_html = `<div class="col-sm-6 col-lg-4 mb-4" data-aos="fade-up">
                <div class="block-4 text-center border">
                  <figure class="block-4-image">
                    <a href="shop-single.html" onclick="setGiftCard(${id})"><img src="${imageUrl}" alt="Image" class="img-fluid"></a>
                  </figure>
                  <div class="block-4-text p-4">
                    <h3><a href="shop-single.html" onclick="setGiftCard(${id})">${name}</a></h3>
                    <p class="mb-0">${details}</p>
                    <p class="text-primary font-weight-bold">${price}원</p>
                    <button type="button" class="btn btn-secondary" onclick="directOrder(${id})">구매하기</button>
                  </div>
                </div>
              </div>`

          $('#gift-cards-box').append(temp_html)
        }
        

      });
    }

    function giftCardListing() {
      let sorting = $("#sorting option:selected").val();
      let isAsc = $(':radio[name="isAsc"]:checked').val();
      let category = localStorage.getItem("categoryName")

      if (!category) {
        getItems('ALL', 1, sorting, isAsc);
      } else {
        getItems(category, 1, sorting, isAsc);
      }
    }

    function getGiftCardList(element) {
      var categoryName = element.children[0].getAttribute("id")
      var category;
      if (categoryName === 'AllCategory') {
        category = 'ALL';
      } else if (categoryName === 'CafeCategory') {
        category = 'CAFE';
      } else if (categoryName === 'ChickenCategory') {
        category = 'CHICKEN';
      } else if (categoryName === 'ConvenienceCategory') {
        category = 'CONVENIENCE_STORE';
      }
      localStorage.setItem("categoryName", category);
      let sorting = $("#sorting option:selected").val();
      let isAsc = $(':radio[name="isAsc"]:checked').val();

      // TODO : currentPage 변수 추가하기
      let currentPage = localStorage.getItem("currentPage")
      getItems(category, 1, sorting, isAsc)

    }

    function directOrder(id) {
      localStorage.setItem("giftCardId", id);
      window.location = '/order.html'
    }

    function setGiftCard(id) {
      localStorage.setItem("giftCardId", id);
    }

  </script>

</body>

</html>